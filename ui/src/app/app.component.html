<div class="stock-tutor-app">
  <!-- Header with Navigation -->
  <header class="app-header">
    <div class="header-content">
      <div class="logo-area">
        <i class="pi pi-chart-line logo-icon"></i>
        <h1 class="app-title">{{ title }}</h1>
      </div>

      <p-menubar [model]="menuItems">
        <ng-template pTemplate="end">
          <button pButton
                  label="Learning History"
                  icon="pi pi-history"
                  class="p-button-text"
                  (click)="showHistory()"></button>
        </ng-template>
      </p-menubar>
    </div>
  </header>

  <!-- Main Content Area -->
  <main class="app-content">
    <p-tabView [(activeIndex)]="activeTabIndex">
      <!-- Dashboard Tab -->
      <p-tabPanel header="Dashboard">
        <div class="grid">
          <!-- Portfolio Summary -->
          <div class="col-12 md:col-6 lg:col-4">
            <p-panel header="Portfolio Summary">
              <div class="portfolio-summary">
                <div class="value-display">
                  <span class="label">Current Value:</span>
                  <span class="value">${{ portfolioValue | number: '1.2-2' }}</span>
                </div>
                <div class="growth-display">
                  <span class="label">Growth:</span>
                  <span class="value" [ngClass]="portfolioGrowth >= 0 ? 'text-green-600' : 'text-red-600'">
                    {{ portfolioGrowth >= 0 ? '+' : '' }}{{ portfolioGrowth }}%
                  </span>
                </div>
                <p-divider></p-divider>
                <div class="portfolio-chart">
                  <p-chart type="doughnut" [data]="portfolioChartData" [options]="chartOptions" height="200px"></p-chart>
                </div>
              </div>
            </p-panel>
          </div>

          <!-- Learning Progress -->
          <div class="col-12 md:col-6 lg:col-4">
            <p-panel header="Learning Progress">
              <div class="learning-progress">
                <div class="progress-header">
                  <span class="progress-label">Learning Completion</span>
                  <span class="progress-value">{{ learningProgress | number: '1.0-0' }}%</span>
                </div>
                <p-progressBar [value]="learningProgress" [showValue]="false" class="mb-3"></p-progressBar>

                <div class="progress-stats">
                  <div class="stat-item">
                    <div class="stat-label">Questions Answered</div>
                    <div class="stat-value">{{ tutorStore.tutorEntities().length }}</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-label">Correct Answers</div>
                    <div class="stat-value">
                      {{ tutorStore.tutorEntities().filter(q => q.isCorrect).length }}
                    </div>
                  </div>
                </div>

                <button pButton label="Continue Learning" icon="pi pi-book"
                        class="p-button-outlined mt-3 w-full"
                        (click)="activeTabIndex = 3"></button>
              </div>
            </p-panel>
          </div>

          <!-- Recent Activity -->
          <div class="col-12 md:col-6 lg:col-4">
            <p-panel header="Recent Activity">
              <div class="recent-activity">
                @if (tutorStore.tutorEntities().length > 0) {
                  <ul class="activity-list">
                    @for (item of tutorStore.tutorEntities().slice(0, 5); track item.id) {
                      <li class="activity-item">
                        <div class="activity-icon" [ngClass]="item.isCorrect ? 'activity-success' : 'activity-error'">
                          <i class="pi" [ngClass]="item.isCorrect ? 'pi-check-circle' : 'pi-times-circle'"></i>
                        </div>
                        <div class="activity-content">
                          <div class="activity-title">{{ item.question }}</div>
                          <div class="activity-time">{{ item.timestamp | date:'short' }}</div>
                        </div>
                      </li>
                    }
                  </ul>
                } @else {
                  <div class="empty-state">
                    <i class="pi pi-info-circle empty-icon"></i>
                    <p>No recent learning activity.</p>
                    <button pButton label="Start Learning" icon="pi pi-book"
                            class="p-button-sm"
                            (click)="activeTabIndex = 3"></button>
                  </div>
                }
              </div>
            </p-panel>
          </div>

          <!-- Market Overview -->
          <div class="col-12">
            <p-panel header="Market Overview">
              <div class="market-overview">
                @if (stockStore.isLoading()) {
                  <div class="loading-state">
                    <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
                    <span class="loading-text">Loading market data...</span>
                  </div>
                } @else if (stockStore.stockEntities().length === 0) {
                  <div class="empty-state">
                    <i class="pi pi-info-circle empty-icon"></i>
                    <p>No market data available.</p>
                    <button pButton label="Refresh Data" icon="pi pi-refresh"
                            (click)="stockStore.resolveStocks()"
                            class="p-button-sm"></button>
                  </div>
                } @else {
                  <div class="stock-highlights">
                    @for (stock of stockStore.stockEntities().slice(0, 8); track stock.tickerSymobol) {
                      <div class="stock-highlight-item">
                        <div class="stock-symbol">{{ stock.tickerSymobol }}</div>
                        <div class="stock-price">${{ stock.price | number:'1.2-2' }}</div>
                        <div class="stock-change" [ngClass]="stock.changePercent >= 0 ? 'text-green-600' : 'text-red-600'">
                          {{ stock.changePercent >= 0 ? '+' : '' }}{{ stock.changePercent | number:'1.2-2' }}%
                        </div>
                      </div>
                    }
                  </div>

                  <button pButton label="View All Stocks" icon="pi pi-list"
                          (click)="activeTabIndex = 1"
                          class="p-button-outlined mt-3"></button>
                }
              </div>
            </p-panel>
          </div>
        </div>
      </p-tabPanel>

      <!-- Stock Market Tab -->
      <p-tabPanel header="Stock Market">
        <h2 class="section-title">Stock Market</h2>
        <p class="section-description">
          Explore available stocks, view their performance, and make purchases to build your portfolio.
        </p>

        <app-stock-component></app-stock-component>
      </p-tabPanel>

      <!-- Portfolio Tab -->
      <p-tabPanel header="Portfolio">
        <h2 class="section-title">Your Portfolio</h2>
        <p class="section-description">
          Track the performance of your stock holdings and manage your investments.
        </p>

        <div class="portfolio-content">
          <p-card styleClass="mb-4">
            <ng-template pTemplate="header">
              <div class="p-3 flex justify-content-between align-items-center">
                <h3 class="m-0">Portfolio Summary</h3>
                <span class="total-value">${{ portfolioValue | number:'1.2-2' }}</span>
              </div>
            </ng-template>

            <div class="portfolio-chart-container">
              <p-chart type="doughnut" [data]="portfolioChartData" [options]="chartOptions" height="300px"></p-chart>
            </div>

            <ng-template pTemplate="footer">
              <div class="flex justify-content-end">
                <button pButton label="Add Stocks" icon="pi pi-plus"
                        (click)="activeTabIndex = 1"
                        class="p-button-outlined"></button>
              </div>
            </ng-template>
          </p-card>

          <!-- Portfolio Content Will Go Here -->
          <p-card styleClass="mt-4" header="Your Holdings">
            <p>No stocks in your portfolio yet. Start by purchasing some stocks!</p>
            <button pButton label="Browse Stocks" icon="pi pi-search"
                    (click)="activeTabIndex = 1"
                    class="p-button-outlined mt-3"></button>
          </p-card>
        </div>
      </p-tabPanel>

      <!-- Learning Tab -->
      <p-tabPanel header="Learning">
        <h2 class="section-title">Learning Center</h2>
        <p class="section-description">
          Enhance your investment knowledge with interactive lessons and quizzes.
        </p>

        <div class="learning-content">
          <p-card styleClass="mb-4" header="Stock Market Basics">
            <div class="learning-module">
              <p>Learn the fundamentals of stock markets, how they work, and key terminology.</p>
              <button pButton label="Start Learning" icon="pi pi-book" class="p-button-success mt-3"></button>
            </div>
          </p-card>

          <p-card styleClass="mb-4" header="Investment Strategies">
            <div class="learning-module">
              <p>Discover different approaches to stock investing and building a balanced portfolio.</p>
              <button pButton label="Start Learning" icon="pi pi-book" class="p-button-success mt-3"></button>
            </div>
          </p-card>

          <p-card styleClass="mb-4" header="Risk Management">
            <div class="learning-module">
              <p>Understand how to assess and manage investment risks for better returns.</p>
              <button pButton label="Start Learning" icon="pi pi-book" class="p-button-success mt-3"></button>
            </div>
          </p-card>
        </div>
      </p-tabPanel>
    </p-tabView>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <div class="footer-content">
      <div class="copyright">© 2023 Stock Learning Platform</div>
    </div>
  </footer>

  <!-- History Sidebar Component -->
  <app-history-component></app-history-component>

  <!-- Toast Messages for notifications -->
  <p-toast position="bottom-right"></p-toast>
</div>
